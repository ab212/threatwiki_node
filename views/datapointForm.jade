extends layout
block head
  script(src="/javascript/datapoint_form.js")
  script(src='http://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyCdCNPG_4JmvjQjbXVyB_W6Ena7b7CIqns&sensor=false')
  script(src='/javascript/jquery.auto-geocoder.js')
  script(src='/javascript/utils.js')
  script(src='/javascript/select2.min.js')


block pageContent
  //
    p Run a console to see JSON data.
      br/
    p  Ctrl+Shift+k in Firefox with 'Net' and 'JS' sources enabled
    p Shift+Ctrl+I for Chromium
    hr/
  ul.breadcrumb
    li 
      a(href="/soc") List of SOC
      span.divider
    if (typeof(socname) != 'undefined' && typeof(datapoint) == 'undefined')
      li 
        a(href="/soc/view?soc="+socname) SOC: #{socname}
        span.divider
      if (typeof(tag) != 'undefined')
        li 
          a(href="/soc/view?soc="+socname+"&tag="+tag._id) Tag: #{tag.title}
          span.divider
    else if (typeof(datapoint) != 'undefined')
      li 
        a(href="/soc/view?soc="+datapoint.soc) SOC: #{datapoint.soc}
        span.divider
      if (typeof(tag) != 'undefined')
        li 
          a(href="/soc/view?soc="+datapoint.soc+"&tag="+tag._id) Tag: #{tag.title}
          span.divider
    if (typeof(datapoint) == 'undefined')
      li.active New Datapoint
    else
      li.active #{datapoint.title}


  div#post_form
    span.bold
      - if (typeof(datapoint) != 'undefined')
        form(id="datapoint_form_update",class="form-horizontal")
          //update datapoint
          input(name="id", value=datapoint._id, type="hidden")
          input(type="hidden", id="soc", name="soc", value=datapoint.soc)
          div(class="control-group")
            label(class="control-label",for="title") Title
            div(class="controls")
              input(type="text", name="title", value=datapoint.title, class="span6")
           div(class="control-group")
            label(class="control-label", for="event_date") Event Date
            div(class="controls")
              input(type="text", class="span2", name="event_date", id="event_date", value=datapoint.event_date)
          div(class="control-group")
            label(class="control-label",for="location") Location
            div(class="controls")
              input(type="text", id="location", name="location", value=datapoint.Location.title)
          div(class="control-group")
            label(class="control-label",for="latitude") Latitude/Longitude
            div(class="controls controls-row")
              input(type="text", class="span2",id="latitude", name="latitude", value=datapoint.Location.latitude)
              input(type="text", class="span2",id="longitude", name="longitude", value=datapoint.Location.longitude)
              span(class="help-inline") Only change those values if you want to adjust the position on the map manually
          div(class="control-group")
            label(class="control-label",for="description") Description
            div(class="controls")
              textarea(name="description", rows="6", class="span6" ) #{datapoint.description}
          div(class="control-group")
            label(class="control-label",for="tags") Tags
            div(class="controls")
              select(multiple id="tag_list", name="tag_list")
                for tag in datapoint.tags
                  option(selected=tag._id, value=tag._id) #{tag.title}
          div(class="form-actions")
            button(type="submit", class="btn btn-success") Save
            p   
            button(type="button",  id="archive", class="btn btn-info") Archive
      - else
        form(id="datapoint_form", class="form-horizontal")
          //if SOC is present in the URL, it means we create a datapoint from a SOC, no need to give option to change SOC 
          //create datapoint
          input(type="hidden", id="soc", name="soc", value=socname)
          div(class="control-group")
            label(class="control-label", for="title") Title
            div(class="controls")
              input(type="text", name="title",class="span6")
          div(class="control-group")
            label(class="control-label", for="event_date") Event Date
            div(class="controls")
              input(type="text", class="span2", name="event_date", id="event_date")
          div(class="control-group")
            label(class="control-label", for="location") Location
            div(class="controls")
              input(type="text", id="location", name="location")
          div(class="control-group")
            label(class="control-label",for="latitude") Latitude/Longitude
            div(class="controls controls-row")
              input(type="text", class="span2", id="latitude", name="latitude")
              input(type="text", class="span2", id="longitude", name="longitude")
              span(class="help-inline") Only change those values if you want to adjust the position on the map manually
          div(class="control-group")
            label(class="control-label",for="description") Description
            div(class="controls")
              textarea(name="description", rows="6", class="span6")
          div(class="control-group")
            label(class="control-label",for="tags") Tags
              div(class="controls")
                select(multiple="multiple", id="tag_list", name="tag_list")
              //if there was tag argument in URL, we auto select it when we create this datapoint
                if (typeof(tag) != 'undefined')
                  option(selected=tag, value=tag._id) #{tag.title}
          div(class="form-actions")
            button(type="submit", class="btn btn-success") Save


  script
    var datapoint_form = $('#datapoint_form');
    var datapoint_form_update = $('#datapoint_form_update');
    var referringURL = document.referrer;

